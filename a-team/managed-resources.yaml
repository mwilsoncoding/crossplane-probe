---
apiVersion: compute.gcp.upbound.io/v1beta1
kind: GlobalAddress
metadata:
  annotations:
    meta.upbound.io/id: compute/v1beta1/globaladdress
  name: db-private-ip
spec:
  forProvider:
    addressType: INTERNAL
    networkRef:
      name: peering-network
    prefixLength: 16
    purpose: VPC_PEERING
---
apiVersion: compute.gcp.upbound.io/v1beta1
kind: Network
metadata:
  name: dev-network
spec:
  forProvider: {}
---
apiVersion: compute.gcp.upbound.io/v1beta1
kind: NetworkPeeringRoutesConfig
metadata:
  annotations:
    meta.upbound.io/id: compute/v1beta1/networkpeeringroutesconfig
  name: peering-primary-routes
spec:
  forProvider:
    exportCustomRoutes: true
    importCustomRoutes: true
    networkRef:
      name: peering-network
    peeringRef:
      name: service-connection
---
apiVersion: compute.gcp.upbound.io/v1beta1
kind: Network
metadata:
  annotations:
    meta.upbound.io/id: compute/v1beta1/peeringnetwork
  name: peering-network
spec:
  forProvider:
    autoCreateSubnetworks: false
---
apiVersion: servicenetworking.gcp.upbound.io/v1beta1
kind: Connection
metadata:
  annotations:
    meta.upbound.io/id: servicenetworking/v1beta1/connection
  name: service-connection
spec:
  forProvider:
    networkRef:
      name: peering-network
    reservedPeeringRangesRefs:
      - name: db-private-ip
    service: servicenetworking.googleapis.com
---
apiVersion: sql.gcp.upbound.io/v1beta1
kind: DatabaseInstance
metadata:
  annotations:
    meta.upbound.io/id: sql/v1beta1/databaseinstance
  name: db-inst-01
spec:
  forProvider:
    databaseVersion: POSTGRES_15
    deletionProtection: false
    region: us-central1
    settings:
      - diskSize: 10
        edition: ENTERPRISE
        insightsConfig:
          - queryInsightsEnabled: true
            queryStringLength: 4500
            recordApplicationTags: true
        ipConfiguration:
          - ipv4Enabled: false
            privateNetworkRef:
              name: peering-network
        tier: db-f1-micro
  writeConnectionSecretToRef:
    name: db-inst-01-connection
    namespace: a-team
---
apiVersion: compute.gcp.upbound.io/v1beta1
kind: Instance
metadata:
  name: my-vm
spec:
  forProvider:
    bootDisk:
      - initializeParams:
          - image: debian-cloud/debian-11
    machineType: f1-micro
    networkInterface:
      - networkRef:
          name: dev-network
    zone: us-east1-b
    desiredStatus: RUNNING
    allowStoppingForUpdate: true
